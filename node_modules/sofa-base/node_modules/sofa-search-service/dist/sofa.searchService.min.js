!function(a){"use strict";a.define("sofa.SearchService",function(b,c,d,e){var f={},g=null,h=b.get("storeCode"),i=b.get("searchDebounceMs",300),j=b.get("searchUrl")+"?callback=JSON_CALLBACK&len=100";f.search=function(a,b){var c=d.defer();return m(c,a,b),c.promise};var k=function(b,d,f){g=a.Util.createGuid();var h=g;return d?c({method:"JSONP",url:j,params:{q:n(o(d)),fetch:"text, categoryUrlKey, categoryName, productUrlKey, productImageUrl"}}).then(function(a){h===g&&(f&&l(a,f),b.resolve(a))}):b.resolve({data:{results:[],groupedResults:[]}}),e&&e(),b.promise},l=function(a){var b=a.data.results,c=b.reduce(function(a,b){if(!a[b.categoryUrlKey]){var c=a[b.categoryUrlKey]={groupKey:b.categoryUrlKey,groupText:b.categoryName,items:[]};a.items.push(c)}return a[b.categoryUrlKey].items.push(b),a},{items:[]});a.data.groupedResults=c.items},m=a.Util.debounce(k,i),n=function(a){var b=a.split("").reverse().join("");return"(text:"+a+"* OR reverse_text:"+b+"*) AND storeCode:"+h},o=function(a){return a.replace(/[áàâä]/g,"a").replace(/[úùûü]/g,"u").replace(/[óòôö]/g,"o").replace(/[éèêë]/g,"e").replace(/[ß]/g,"ss")};return f})}(sofa);